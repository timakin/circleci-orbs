version: 2.1

examples:
  go-module:
    description: "Usage of timakin/go-module orb"
    usage:
      version: 2.1
      orbs:
        go-module: timakin/go-module@volatile
      jobs:
        setup:
          docker:
            - image: circleci/golang:1.11.1-stretch
          steps:
            - checkout
            - go-module/setup:
                app_name: go-project
                vendoring: true

commands:
  setup:
    parameters:
      vendoring:
        description: "Whether the job should call `go mod vendor` in steps."
        type: boolean
        default: false
      project_name:
        description: "Built project name"
        type: string
        default: go-mod-cache
    steps:
      - restore_cache:
          name: Restore go modules cache
          key: << parameters.project_name >>-{{ .Branch }}-{{ checksum "go.sum" }}
      - run:
          name: Downloading packages
          command: go mod download
      - save_cache:
          name: Saving Cache
          key: << parameters.project_name >>-{{ .Branch }}-{{ checksum "go.sum" }}
          paths:
            - "/go/pkg/mod/cache"
      - run:
          name: Vendoring
          command: |
            if << parameters.vendoring >>; then
              go mod vendor
            fi
